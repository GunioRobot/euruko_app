<% title "#{@paper.title}" %>

<h3>Talk Details</h3>

<h4>
  <%= yield(:title) %>
  <% if logged_in? && current_user.is_speaker_on_or_admin?( @paper ) %>
    <%= link_to 'Edit', edit_paper_path(@paper) %>
  <% end %>
</h4>

<div class="entry">
  <%= image_tag @paper.photo.url(:medium), :class => 'avatar' %>

  <h6>
    On <%= @paper.date.nil? ? '(not date designed yet)' : @paper.date.strftime("%b #{@paper.date.day.ordinalize}, %H:%M %p") %> 
    at <%= @paper.room.nil? ? '(not room designed yet)' : @paper.room.name %>
  </h6>
  <p>
    By
    <% @paper.speakers.collect{ |s| s.user }.each do |user| %>
      <%= link_to user.name, user %>
    <% end %>
  </p>
  <%= simple_format @paper.description %>

  <div id="resources">
    <h6>Resources</h6>
    <ul>
      <% @paper.resources.each do |resource| %>
        <li><%= link_to resource.url_link, resource.url_link %></li>
      <% end %>
    </ul>
  </div>
  
  <div id="valorations">
    <%= render :partial => 'papers/valorations', :locals => { :paper => @paper } %>
  </div>
  
  <div id="attendees">
    <h6>Attendees (<%=h @paper.attendees.count %>)</h6>
    <%= render :partial => 'papers/attendees', :locals => { :paper => @paper } %>  

    <ul>
      <% @paper.attendees.each do |attendee| %>
        <li><%= attendee.user.name %></li>
      <% end %>
    </ul>
  </div>
  
  <div id="comments">
    <h6>Comments (<%=h @paper.comments.count %>)</h6>
    <div id="comments_list">
      <%= render :partial => 'papers/comment', :collection => @paper.comments %>
    </div>
    
    <% if logged_in? %>
      <div class="comment_error"></div>

        <%
          form_remote_for(
            [@paper, Comment.new],
            :update => { :success => "comments_list", :failure => ".comment_error" },
            :position => :bottom,
            :loading => "$('#comment_loading').show()",
            :complete => "$('#comment_loading').hide();",
            :success => "$('#comment_textarea').val('')"
          ) do |f| 
        -%>
        <%= f.error_messages %>
    
        <%= f.label :new_comment, 'New Comment', :required => true %><br/>
        <%= f.text_area :text, :id => 'comment_textarea' %><br/>
        <div id='comment_loading' style="display:none"><%= image_tag 'spinner.gif' %></div>
        <%= f.submit "Submit", :disable_with => 'Submiting...' %>
        <% end -%>
    <% end %>
  </div>
</div>
